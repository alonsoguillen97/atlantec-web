---
import '../styles/global.css';

export interface Props {
  title: string;
  description?: string;
}

const { title, description = 'Una descripción por defecto' } = Astro.props;
---

<!doctype html>
<html lang="es" class="scroll-smooth">
  <head>
    <meta charset="UTF-8" />
    <meta name="description" content={description} />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    
    <!-- Favicon ATLANTEC -->
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png" />
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png" />
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png" />
    <link rel="manifest" href="/site.webmanifest" />

    <!-- SEO Meta Tags -->
    <title>{title}</title>
    <meta
      name="keywords"
      content="ATLANTEC, servicios informáticos, Cádiz, Barbate, Zahara, El Palmar, desarrollo web, aplicaciones móviles, IA, TPV, marketing digital, costa, turismo"
    />
    <meta name="author" content="ATLANTEC S.L." />
    <meta property="og:title" content={title} />
    <meta property="og:description" content={description} />
    <meta property="og:type" content="website" />
    <meta property="og:url" content={Astro.url} />
    <meta property="og:locale" content="es_ES" />
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content={title} />
    <meta name="twitter:description" content={description} />
    <!-- Datos estructurados para SEO local -->
    <script type="application/ld+json">
      {
        "@context": "https://schema.org",
        "@type": "Organization",
        "name": "ATLANTEC",
        "description": "Servicios informáticos especializados en la costa de Cádiz",
        "url": "https://atlantec.es",
        "address": {
          "@type": "PostalAddress",
          "addressRegion": "Andalucía",
          "addressCountry": "ES"
        },
        "areaServed": ["Barbate", "Zahara de los Atunes", "El Palmar", "Cádiz"],
        "slogan": "Desde el sur conectamos negocios con el futuro"
      }
    </script>
  </head>
  <body class="bg-white text-gray-900 antialiased">
    <slot />
    <script>
      // Animaciones de scroll modernas
      function initScrollAnimations() {
        const observerOptions = {
          threshold: 0.1,
          rootMargin: '0px 0px -50px 0px',
        };

        const observer = new IntersectionObserver((entries) => {
          entries.forEach((entry) => {
            if (entry.isIntersecting) {
              const element = entry.target as HTMLElement;
              element.style.opacity = '1';
              element.style.transform = 'translateY(0)';

              // Añadir delay escalonado para elementos hermanos
              if (element.parentNode) {
                const siblings = Array.from(element.parentNode.children);
                const index = siblings.indexOf(element);
                element.style.transitionDelay = `${index * 0.1}s`;
              }
            }
          });
        }, observerOptions);

        // Observar elementos con animaciones
        document
          .querySelectorAll(
            '.animate-on-scroll, .hover-lift, [class*="animate-"]'
          )
          .forEach((el) => {
            const element = el as HTMLElement;
            if (!element.classList.contains('animate-float')) {
              element.style.opacity = '0';
              element.style.transform = 'translateY(30px)';
              element.style.transition =
                'opacity 0.6s ease-out, transform 0.6s ease-out';
              observer.observe(element);
            }
          });
      }

      // Smooth scroll mejorado
      function initSmoothScroll() {
        document.querySelectorAll('a[href^="#"]').forEach((anchor) => {
          const link = anchor as HTMLAnchorElement;
          link.addEventListener('click', function (e) {
            e.preventDefault();
            const href = this.getAttribute('href');
            if (href) {
              const target = document.querySelector(href) as HTMLElement;
              if (target) {
                const offsetTop = target.offsetTop - 80; // Ajustar para header fijo
                window.scrollTo({
                  top: offsetTop,
                  behavior: 'smooth',
                });
              }
            }
          });
        });
      }

      // Efectos de header en scroll respetando el modo claro/oscuro
      function initHeaderEffects() {
        let ticking = false;

        function updateHeader() {
          const scrolled = window.pageYOffset;
          const header = document.querySelector('header') as HTMLElement;
          const html = document.documentElement;

          if (header) {
            if (scrolled > 50) {
              header.classList.add('scrolled');
            } else {
              header.classList.remove('scrolled');
            }
          }

          ticking = false;
        }

        function requestTick() {
          if (!ticking) {
            requestAnimationFrame(updateHeader);
            ticking = true;
          }
        }

        window.addEventListener('scroll', requestTick);
      }

      document.addEventListener('DOMContentLoaded', () => {
        // Inicializar animaciones
        initScrollAnimations();
        initSmoothScroll();
        initHeaderEffects();

        // Añadir clase para elementos visibles inicialmente
        setTimeout(() => {
          document
            .querySelectorAll(
              '.animate-fadeIn, .animate-fadeInUp, .animate-slideInLeft, .animate-slideInRight'
            )
            .forEach((el) => {
              const element = el as HTMLElement;
              const rect = element.getBoundingClientRect();
              if (rect.top < window.innerHeight) {
                element.style.opacity = '1';
                element.style.transform = 'translateY(0) translateX(0)';
              }
            });
        }, 100);
      });
    </script>
  </body>
</html>
